networks:
  caddy:
    external: true
    name: ${CADDY_NETWORK:-caddy}

services:
  piper-tts:
    build: .
    container_name: yap-piper-tts
    restart: unless-stopped
    volumes:
      - ${PIPER_MODELS_PATH:-/srv/piper/models}:/models:ro
    environment:
      - PIPER_MODELS_PATH=/models
    networks: [caddy]
    healthcheck:
      test: ["CMD", "curl", "-f", "http://127.0.0.1:5000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

  tts-ui:
    image: nginx:alpine
    container_name: yap-tts-ui
    restart: unless-stopped
    volumes:
      - ./ui:/usr/share/nginx/html:ro
    networks: [caddy]
    labels:
      caddy: ${TTS_DOMAIN:-tts.localhost}
      caddy.tls: internal
      caddy.1_@api.path: /health /voices /docs /docs/* /openapi.json /redoc /redoc/* /synthesize/*
      caddy.2_reverse_proxy: "@api piper-tts:5000"
      caddy.3_reverse_proxy: "{{upstreams 80}}"
