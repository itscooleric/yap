<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Yap - Speech Tools</title>
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">
  <link rel="stylesheet" href="/css/styles.css">
</head>
<body>
  <div class="container">
    <header>
      <div class="header-row">
        <div class="header-left">
          <h1>yap</h1>
          <div class="recording-indicator" id="recordingIndicator" title="Click to return to ASR">
            <span class="rec-dot"></span>
            <span>Recording <span id="recordingIndicatorTime">00:00</span></span>
          </div>
        </div>
        <nav class="nav-tabs">
          <button data-tab="asr" class="active">ASR</button>
          <button data-tab="tts">TTS</button>
          <button data-tab="data" id="dataBtn" style="display: none;">Data</button>
          <button id="addonsBtn">Apps</button>
          <button id="settingsBtn" class="settings-btn" title="Settings">Settings</button>
        </nav>
      </div>
      <p class="tagline">local speech tools</p>
    </header>

    <main>
      <!-- ASR Tab -->
      <div id="asr-tab" class="tab-content active">
        <!-- Mobile Sticky Toolbar -->
        <div id="mobileToolbar" class="mobile-toolbar" style="display: none;">
          <div class="mobile-toolbar-actions">
            <button id="mobileRecordBtn" class="mobile-btn mobile-btn-primary" title="Record">
              <span class="mobile-btn-icon">‚è∫</span>
              <span class="mobile-btn-label">Record</span>
            </button>
            <button id="mobileTranscribeBtn" class="mobile-btn" disabled title="Transcribe">
              <span class="mobile-btn-icon">üìù</span>
              <span class="mobile-btn-label">Transcribe</span>
            </button>
            <button id="mobileCopyBtn" class="mobile-btn" disabled title="Copy">
              <span class="mobile-btn-icon">üìã</span>
              <span class="mobile-btn-label">Copy</span>
            </button>
            <button id="mobileExportBtn" class="mobile-btn" disabled title="Export">
              <span class="mobile-btn-icon">üì§</span>
              <span class="mobile-btn-label">Export</span>
            </button>
            <button id="mobileMenuBtn" class="mobile-btn" title="More">
              <span class="mobile-btn-icon">‚ãØ</span>
            </button>
          </div>
          <div class="mobile-toolbar-status">
            <span class="mobile-status-dot" id="mobileStatusDot"></span>
            <span id="mobileStatusText">Idle</span>
          </div>
        </div>

        <div class="panel">
          <div class="panel-header">Recording</div>

          <div class="waveform-container">
            <canvas id="waveform"></canvas>
          </div>

          <div class="status-bar">
            <div class="status">
              <span class="status-dot" id="asrStatusDot"></span>
              <span id="asrStatusText">Idle</span>
            </div>
            <div class="timer" id="timer">00:00</div>
          </div>

          <div class="controls">
            <button id="recordBtn" class="primary">Record</button>
            <button id="stopBtn" disabled>Stop</button>
            <button id="transcribeAllBtn" disabled>Transcribe All</button>
            <button id="clearBtn" disabled>Clear</button>
            <button id="asrUploadBtn" type="button">Upload</button>
          </div>

          <div class="form-group" style="margin-top: 0.5rem;">
            <!-- <span id="asrFileName" style="color: var(--text-secondary); font-size: 0.85rem;">No file selected</span> -->
            <input type="file" id="asrFileInput" accept="audio/*,.mp3,.wav,.webm,.ogg,.m4a,.flac" style="display: none;">
          </div>

          <div class="clips-list" id="clipsList">
            <div class="clips-list-header">
              <span class="clips-list-title">Clips</span>
              <span id="clipsCount" class="clips-list-title">0</span>
            </div>
            <div id="clipsContainer">
              <div class="no-clips">No clips recorded</div>
            </div>
          </div>
        </div>

        <div class="panel">
          <div class="panel-header">Transcript</div>
          <textarea id="transcript" class="transcript-area" placeholder="Transcript will appear here..." readonly></textarea>

          <div class="output-controls">
            <button id="copyBtn" disabled title="Copy transcript">Copy</button>
            <button id="downloadTxtBtn" disabled>Download .txt</button>
            <button id="exportBtn" disabled title="Export to GitLab/GitHub/SFTP">Export</button>
          </div>

          <div id="asrMessage" class="message" style="display: none;"></div>
        </div>
      </div>

      <!-- TTS Tab -->
      <div id="tts-tab" class="tab-content">
        <div class="panel">
          <div class="panel-header">Text Input</div>

          <div class="form-group">
            <div class="tts-input-header">
              <label for="ttsTextInput">Text to synthesize:</label>
              <div class="tts-preview-toggle">
                <label class="toggle-label-inline">
                  <input type="checkbox" id="ttsMarkdownToggle">
                  <span>Markdown preview</span>
                </label>
              </div>
            </div>
            <textarea id="ttsTextInput" class="text-input" placeholder="Enter text to convert to speech..."></textarea>
            <div id="ttsMarkdownPreview" class="markdown-preview" style="display: none;"></div>
            <div class="char-count"><span id="charCount">0</span> characters</div>
          </div>

          <div class="form-group">
            <label>Or upload a text file:</label>
            <div class="file-input-wrapper">
              <button id="ttsUploadBtn" type="button">Choose .txt file</button>
              <span id="ttsFileName" style="color: var(--text-secondary); font-size: 0.85rem;">No file selected</span>
              <input type="file" id="ttsFileInput" accept=".txt,text/plain,.md">
            </div>
          </div>
        </div>

        <div class="panel">
          <div class="panel-header">Voice Settings</div>

          <div class="form-group">
            <label for="voiceSelect">Voice:</label>
            <select id="voiceSelect">
              <option value="">Loading voices...</option>
            </select>
          </div>

          <div class="form-group">
            <label for="rateSlider">Speaking Rate:</label>
            <div class="slider-container">
              <span style="font-size: 0.8rem; color: var(--text-secondary);">Fast</span>
              <input type="range" id="rateSlider" min="0.5" max="2.0" step="0.1" value="1.0">
              <span style="font-size: 0.8rem; color: var(--text-secondary);">Slow</span>
              <span class="slider-value" id="rateValue">1.0x</span>
            </div>
            <div style="font-size: 0.75rem; color: var(--text-secondary); margin-top: 0.25rem;">
              (length_scale: lower = faster, higher = slower)
            </div>
          </div>
          
          <div class="form-group">
            <div class="toggle-container">
              <input type="checkbox" id="ttsReadAlongToggle">
              <label for="ttsReadAlongToggle" style="margin: 0; text-transform: none; font-size: 0.85rem; color: var(--text-primary);">Read-along mode</label>
            </div>
            <div style="font-size: 0.7rem; color: var(--text-muted); margin-top: 0.25rem;">
              Highlight paragraphs as they play
            </div>
          </div>
        </div>

        <div class="panel">
          <div class="panel-header">Synthesis</div>

          <div class="status-bar">
            <div class="status">
              <span class="status-dot" id="ttsStatusDot"></span>
              <span id="ttsStatusText">Ready</span>
            </div>
          </div>

          <div class="controls">
            <button id="synthesizeBtn" class="primary" disabled>Synthesize</button>
            <button id="ttsClearBtn">Clear Text</button>
          </div>
        </div>

        <div class="panel" id="ttsOutputPanel" style="display: none;">
          <div class="panel-header">Output</div>

          <div class="audio-container">
            <audio id="ttsAudioPlayer" controls></audio>
          </div>

          <div class="output-controls">
            <button id="ttsDownloadBtn">Download .wav</button>
            <button id="ttsPlayBtn">Play</button>
          </div>

          <div id="ttsMessage" class="message" style="display: none;"></div>
        </div>
      </div>

      <!-- Data Tab -->
      <div id="data-tab" class="tab-content">
        <div class="panel">
          <div class="panel-header">Metrics Summary</div>
          
          <div class="data-summary">
            <div class="data-period">
              <h3>Today</h3>
              <div class="data-stats">
                <div class="data-stat">
                  <span class="data-stat-label">Recorded</span>
                  <span class="data-stat-value" id="todayRecorded">0 min</span>
                </div>
                <div class="data-stat">
                  <span class="data-stat-label">Transcribed</span>
                  <span class="data-stat-value" id="todayTranscribed">0 min</span>
                </div>
                <div class="data-stat">
                  <span class="data-stat-label">TTS Generated</span>
                  <span class="data-stat-value" id="todayTTS">0 min</span>
                </div>
                <div class="data-stat">
                  <span class="data-stat-label">Characters</span>
                  <span class="data-stat-value" id="todayChars">0</span>
                </div>
              </div>
            </div>
            
            <div class="data-period">
              <h3>Last 7 Days</h3>
              <div class="data-stats">
                <div class="data-stat">
                  <span class="data-stat-label">Recorded</span>
                  <span class="data-stat-value" id="week7Recorded">0 min</span>
                </div>
                <div class="data-stat">
                  <span class="data-stat-label">Transcribed</span>
                  <span class="data-stat-value" id="week7Transcribed">0 min</span>
                </div>
                <div class="data-stat">
                  <span class="data-stat-label">TTS Generated</span>
                  <span class="data-stat-value" id="week7TTS">0 min</span>
                </div>
                <div class="data-stat">
                  <span class="data-stat-label">Characters</span>
                  <span class="data-stat-value" id="week7Chars">0</span>
                </div>
              </div>
            </div>
          </div>
          
          <div class="data-controls">
            <button id="exportHistoryBtn" class="secondary">Export JSON</button>
            <button id="clearHistoryBtn" class="danger">Clear History</button>
          </div>
        </div>
        
        <div class="panel">
          <div class="panel-header">History</div>
          
          <div class="data-history-container">
            <table class="data-history-table" id="historyTable">
              <thead>
                <tr>
                  <th>Time</th>
                  <th>Type</th>
                  <th>Duration</th>
                  <th>Chars</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody id="historyTableBody">
                <tr>
                  <td colspan="5" class="no-data">No history available. Enable metrics in Settings.</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </main>

    <footer>
      <p>YAP local speech tools</p>
    </footer>
  </div>

  <!-- Apps panel (hidden by default) -->
  <div class="addon-panel" id="addonPanel" style="display: none;">
    <div class="addon-panel-header">
      <span class="addon-panel-title">Apps</span>
      <button class="addon-window-close" id="addonPanelClose">x</button>
    </div>
    <div class="addon-panel-list" id="addonPanelList"></div>
  </div>

  <script type="module" src="/js/main.js"></script>
</body>
</html>
